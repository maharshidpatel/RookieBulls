# docker-compose.yml â€” Local Development Containers
#
# Defines the containers that run supporting services for Rookie Bulls.
# Your Node.js server runs outside Docker during development.
# Only the database and its admin UI run inside Docker.
#
# Commands:
#   Start containers:   docker compose up -d
#   Stop containers:    docker compose down
#   View logs:          docker compose logs
#   View running:       docker ps

version: '3.8'

services:

  mongo:
    # Official MongoDB image version 7
    # Version is pinned to avoid unexpected breaking changes
    # on future pulls
    image: mongo:7
    container_name: stocksim-mongo
    restart: unless-stopped
    environment:
      # Root credentials for MongoDB admin access
      # These must match the credentials in your .env MONGO_URI
      MONGO_INITDB_ROOT_USERNAME: root
      MONGO_INITDB_ROOT_PASSWORD: example
      MONGO_INITDB_DATABASE: stocksim
    ports:
      # Maps container port 27017 to your machine port 27017
      # Format is host:container
      # Your Node.js server connects via localhost:27017
      - "27017:27017"
    volumes:
      # Named volume persists database data between container restarts
      # Without this, all data is lost every time the container stops
      - mongo-data:/data/db

  mongo-express:
    # Browser-based MongoDB admin UI
    # Access at http://localhost:8081
    image: mongo-express:latest
    container_name: stocksim-mongo-express
    restart: unless-stopped
    environment:
      ME_CONFIG_MONGODB_ADMINUSERNAME: root
      ME_CONFIG_MONGODB_ADMINPASSWORD: example
      ME_CONFIG_MONGODB_SERVER: mongo
      # Basic auth credentials for the Mongo Express web UI
      ME_CONFIG_BASICAUTH_USERNAME: admin
      ME_CONFIG_BASICAUTH_PASSWORD: admin123
    ports:
      - "8081:8081"
    depends_on:
      # Ensures mongo starts before mongo-express
      # Otherwise mongo-express tries to connect before
      # MongoDB is ready and fails
      - mongo

# Named volumes are managed by Docker
# Data persists in a Docker-managed location on your machine
# Not inside your project folder
volumes:
  mongo-data: